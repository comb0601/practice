<Window x:Class="LargeObjectHeap.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Large Object Heap Management" Height="750" Width="1100"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="MinWidth" Value="120"/>
        </Style>
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="5"/>
        </Style>
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="180"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#673AB7" Padding="15">
            <StackPanel>
                <TextBlock Text="Large Object Heap (LOH) Management"
                          FontSize="24" FontWeight="Bold" Foreground="White"/>
                <TextBlock Text="Understanding and optimizing Large Object Heap allocations and pooling strategies"
                          FontSize="14" Foreground="#E1BEE7" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <TabControl Grid.Row="1" Margin="10">
            <!-- LOH Basics -->
            <TabItem Header="LOH Basics">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="Large Object Heap Fundamentals" FontSize="18" FontWeight="Bold"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,5">
                            Objects >= 85,000 bytes (85 KB) are allocated on the Large Object Heap (LOH).
                            The LOH is part of Generation 2 and has special characteristics.
                        </TextBlock>

                        <GroupBox Header="Allocation Threshold">
                            <StackPanel>
                                <Border Background="#E1F5FE" Padding="10" Margin="0,0,0,10" BorderBrush="#0277BD" BorderThickness="1">
                                    <StackPanel>
                                        <TextBlock Text="LOH Threshold: 85,000 bytes (85 KB)" FontWeight="Bold" FontSize="14"/>
                                        <TextBlock TextWrapping="Wrap" Margin="0,5,0,0">
                                            • Arrays with >= 85,000 bytes go to LOH
                                            <LineBreak/>
                                            • byte[85000] or larger → LOH
                                            <LineBreak/>
                                            • int[21250] or larger → LOH (21,250 × 4 bytes = 85,000)
                                            <LineBreak/>
                                            • LOH objects skip Gen0 and Gen1, go directly to Gen2
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <TextBlock Text="Test Allocations:" FontWeight="Bold"/>
                                <WrapPanel>
                                    <Button Content="Allocate Small (80 KB)" Click="AllocateSmall_Click"/>
                                    <Button Content="Allocate LOH (100 KB)" Click="AllocateLOH_Click"/>
                                    <Button Content="Allocate Large (1 MB)" Click="AllocateLarge_Click"/>
                                    <Button Content="Clear All" Click="ClearAllocations_Click"/>
                                </WrapPanel>

                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Background="#C8E6C9" Padding="10" Margin="5" BorderBrush="#4CAF50" BorderThickness="2">
                                        <StackPanel>
                                            <TextBlock Text="Small Object Heap" FontWeight="Bold" FontSize="14" Foreground="#2E7D32"/>
                                            <TextBlock x:Name="SOHCount" Text="Objects: 0" Margin="0,5,0,0"/>
                                            <TextBlock x:Name="SOHSize" Text="Total Size: 0 MB"/>
                                            <TextBlock Text="(Gen0/Gen1/Gen2)" FontStyle="Italic" Foreground="#666"/>
                                        </StackPanel>
                                    </Border>

                                    <Border Grid.Column="1" Background="#FFCCBC" Padding="10" Margin="5" BorderBrush="#E64A19" BorderThickness="2">
                                        <StackPanel>
                                            <TextBlock Text="Large Object Heap" FontWeight="Bold" FontSize="14" Foreground="#BF360C"/>
                                            <TextBlock x:Name="LOHCount" Text="Objects: 0" Margin="0,5,0,0"/>
                                            <TextBlock x:Name="LOHSize" Text="Total Size: 0 MB"/>
                                            <TextBlock x:Name="LOHFragmentation" Text="Fragmented: 0 MB" Foreground="#D32F2F"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Fragmentation -->
            <TabItem Header="Fragmentation">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="LOH Fragmentation" FontSize="18" FontWeight="Bold"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,5">
                            By default, the LOH is NOT compacted during garbage collection, leading to
                            fragmentation. This can cause memory issues even when total memory seems available.
                        </TextBlock>

                        <GroupBox Header="Fragmentation Demonstration">
                            <StackPanel>
                                <Border Background="#FFF3E0" Padding="10" Margin="0,0,0,10" BorderBrush="#FF6F00" BorderThickness="1">
                                    <StackPanel>
                                        <TextBlock Text="How Fragmentation Occurs:" FontWeight="Bold"/>
                                        <TextBlock TextWrapping="Wrap" Margin="0,5,0,0">
                                            1. Allocate several large objects in LOH
                                            <LineBreak/>
                                            2. Release every other object (creating gaps)
                                            <LineBreak/>
                                            3. Try to allocate new large objects
                                            <LineBreak/>
                                            4. May fail even if total free space is sufficient
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <WrapPanel>
                                    <Button Content="Create Fragmentation" Click="CreateFragmentation_Click"/>
                                    <Button Content="Attempt Allocation" Click="AttemptFragmentedAllocation_Click"/>
                                    <Button Content="Compact LOH" Click="CompactLOH_Click"/>
                                    <Button Content="Reset" Click="ResetFragmentation_Click"/>
                                </WrapPanel>

                                <TextBlock Text="Fragmentation Visualization:" FontWeight="Bold" Margin="0,10,0,5"/>
                                <Border BorderBrush="#9E9E9E" BorderThickness="1" Height="80" Background="White">
                                    <Canvas x:Name="FragmentationCanvas" Background="#F5F5F5"/>
                                </Border>

                                <StackPanel Margin="0,10,0,0">
                                    <TextBlock x:Name="FragmentationStatus" Text="Status: No fragmentation" FontWeight="Bold"/>
                                    <TextBlock x:Name="FragmentationStats" Text="Free blocks: 0, Total free: 0 MB" Margin="0,5,0,0"/>
                                </StackPanel>

                                <Border Background="#FFEBEE" Padding="10" Margin="0,10,0,0" BorderBrush="#C62828" BorderThickness="1">
                                    <TextBlock TextWrapping="Wrap">
                                        <Run FontWeight="Bold">Warning:</Run> Fragmentation can lead to OutOfMemoryException
                                        even when plenty of memory is available, just not in contiguous blocks!
                                    </TextBlock>
                                </Border>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Compaction -->
            <TabItem Header="Compaction">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="LOH Compaction" FontSize="18" FontWeight="Bold"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,5">
                            Starting with .NET 4.5.1, you can request LOH compaction to eliminate fragmentation.
                            Understand when and how to use this feature.
                        </TextBlock>

                        <GroupBox Header="Compaction Control">
                            <StackPanel>
                                <Border Background="#E8F5E9" Padding="10" Margin="0,0,0,10" BorderBrush="#4CAF50" BorderThickness="1">
                                    <StackPanel>
                                        <TextBlock Text="Compaction Options:" FontWeight="Bold"/>
                                        <TextBlock TextWrapping="Wrap" Margin="0,5,0,0">
                                            • <Run FontWeight="Bold">Default:</Run> LOH is swept, not compacted
                                            <LineBreak/>
                                            • <Run FontWeight="Bold">OncePerProcess:</Run> Compact on next blocking Gen2 GC
                                            <LineBreak/>
                                            • <Run FontWeight="Bold">Via GC.Collect:</Run> Force compacting collection
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <TextBlock Text="Compaction Mode:" FontWeight="Bold"/>
                                <TextBlock x:Name="CompactionMode" Text="Current: Default" Margin="0,5,0,10"/>

                                <WrapPanel>
                                    <Button Content="Enable Compaction" Click="EnableCompaction_Click"/>
                                    <Button Content="Force Compact GC" Click="ForceCompactGC_Click"/>
                                    <Button Content="Reset to Default" Click="ResetCompaction_Click"/>
                                </WrapPanel>

                                <TextBlock Text="Before Compaction:" FontWeight="Bold" Margin="0,15,0,0"/>
                                <StackPanel x:Name="BeforeCompactionStats" Margin="5">
                                    <TextBlock x:Name="BeforeLOHSize" Text="LOH Size: -- MB"/>
                                    <TextBlock x:Name="BeforeFragmented" Text="Fragmented: -- MB"/>
                                </StackPanel>

                                <TextBlock Text="After Compaction:" FontWeight="Bold" Margin="0,10,0,0"/>
                                <StackPanel x:Name="AfterCompactionStats" Margin="5">
                                    <TextBlock x:Name="AfterLOHSize" Text="LOH Size: -- MB"/>
                                    <TextBlock x:Name="AfterFragmented" Text="Fragmented: -- MB"/>
                                    <TextBlock x:Name="CompactionResult" Text="Result: --" FontWeight="Bold" Foreground="Green"/>
                                </StackPanel>

                                <Border Background="#FFF3E0" Padding="10" Margin="0,10,0,0" BorderBrush="#FF6F00" BorderThickness="1">
                                    <TextBlock TextWrapping="Wrap">
                                        <Run FontWeight="Bold">Note:</Run> Compaction is expensive! Only use when fragmentation
                                        is causing problems. Better to prevent fragmentation through pooling.
                                    </TextBlock>
                                </Border>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Buffer Pooling -->
            <TabItem Header="Buffer Pooling">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="Large Buffer Pooling" FontSize="18" FontWeight="Bold"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,5">
                            The best way to avoid LOH problems is to pool and reuse large buffers instead
                            of repeatedly allocating and releasing them.
                        </TextBlock>

                        <GroupBox Header="ArrayPool for Large Buffers">
                            <StackPanel>
                                <Border Background="#E8F5E9" Padding="10" Margin="0,0,0,10" BorderBrush="#4CAF50" BorderThickness="1">
                                    <StackPanel>
                                        <TextBlock Text="ArrayPool Benefits:" FontWeight="Bold"/>
                                        <TextBlock TextWrapping="Wrap" Margin="0,5,0,0">
                                            • Zero allocations after pool warm-up
                                            <LineBreak/>
                                            • No LOH fragmentation
                                            <LineBreak/>
                                            • No GC pressure
                                            <LineBreak/>
                                            • Thread-safe built-in implementation
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Without Pooling -->
                                    <Border Grid.Column="0" Background="#FFEBEE" Padding="10" Margin="5" BorderBrush="#F44336" BorderThickness="2">
                                        <StackPanel>
                                            <TextBlock Text="WITHOUT Pooling" FontWeight="Bold" FontSize="14" Foreground="#C62828"/>
                                            <Button Content="Process 1000 Buffers" Click="ProcessWithoutPool_Click" Margin="0,10,0,0"/>
                                            <TextBlock x:Name="WithoutPoolStats" Text="Allocations: 0" Margin="0,10,0,0"/>
                                            <TextBlock x:Name="WithoutPoolMemory" Text="Memory used: 0 MB"/>
                                            <TextBlock x:Name="WithoutPoolGC" Text="GC collections: 0"/>
                                            <TextBlock x:Name="WithoutPoolTime" Text="Time: 0 ms" FontWeight="Bold"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- With Pooling -->
                                    <Border Grid.Column="1" Background="#E8F5E9" Padding="10" Margin="5" BorderBrush="#4CAF50" BorderThickness="2">
                                        <StackPanel>
                                            <TextBlock Text="WITH Pooling" FontWeight="Bold" FontSize="14" Foreground="#2E7D32"/>
                                            <Button Content="Process 1000 Buffers" Click="ProcessWithPool_Click" Margin="0,10,0,0"/>
                                            <TextBlock x:Name="WithPoolStats" Text="Allocations: 0" Margin="0,10,0,0"/>
                                            <TextBlock x:Name="WithPoolMemory" Text="Memory used: 0 MB"/>
                                            <TextBlock x:Name="WithPoolGC" Text="GC collections: 0"/>
                                            <TextBlock x:Name="WithPoolTime" Text="Time: 0 ms" FontWeight="Bold"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <Border Background="#E1F5FE" Padding="10" Margin="0,10,0,0" BorderBrush="#0277BD" BorderThickness="1">
                                    <TextBlock TextWrapping="Wrap">
                                        <Run FontWeight="Bold">Best Practice:</Run> Always use ArrayPool&lt;T&gt; for temporary
                                        large buffers (image processing, network I/O, file operations, etc.).
                                    </TextBlock>
                                </Border>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Custom Large Object Pool">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap">
                                    For non-array large objects, implement custom pooling:
                                </TextBlock>

                                <WrapPanel Margin="0,10,0,0">
                                    <Button Content="Create Custom Pool" Click="CreateCustomPool_Click"/>
                                    <Button Content="Use from Pool (100x)" Click="UseCustomPool_Click"/>
                                    <Button Content="Clear Pool" Click="ClearCustomPool_Click"/>
                                </WrapPanel>

                                <TextBlock Text="Pool Statistics:" FontWeight="Bold" Margin="0,10,0,0"/>
                                <TextBlock x:Name="CustomPoolStats" Text="Pool size: 0, Reused: 0 times"/>
                                <TextBlock x:Name="CustomPoolMemory" Text="Total memory: 0 MB" Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Strategies -->
            <TabItem Header="Optimization Strategies">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="LOH Optimization Strategies" FontSize="18" FontWeight="Bold"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,5">
                            Practical strategies for avoiding LOH problems in real-world applications.
                        </TextBlock>

                        <GroupBox Header="Strategy 1: Stay Below Threshold">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap">
                                    Keep allocations under 85 KB when possible:
                                </TextBlock>

                                <WrapPanel Margin="0,10,0,0">
                                    <Button Content="Allocate 84 KB Array" Click="AllocateJustUnder_Click"/>
                                    <Button Content="Allocate 85 KB Array" Click="AllocateJustOver_Click"/>
                                </WrapPanel>

                                <TextBlock x:Name="ThresholdResult" Text="" Margin="0,10,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Strategy 2: Segment Large Data">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap">
                                    Instead of one large array, use multiple smaller arrays:
                                </TextBlock>

                                <WrapPanel Margin="0,10,0,0">
                                    <Button Content="Single Large Array (10 MB)" Click="SingleLargeArray_Click"/>
                                    <Button Content="Segmented Arrays (125×80KB)" Click="SegmentedArrays_Click"/>
                                </WrapPanel>

                                <TextBlock x:Name="SegmentationResult" Text="" Margin="0,10,0,0" TextWrapping="Wrap"/>

                                <Border Background="#E1F5FE" Padding="10" Margin="0,10,0,0" BorderBrush="#0277BD" BorderThickness="1">
                                    <TextBlock TextWrapping="Wrap">
                                        <Run FontWeight="Bold">Advantage:</Run> Smaller arrays stay on SOH, avoiding LOH fragmentation.
                                        <LineBreak/>
                                        <Run FontWeight="Bold">Trade-off:</Run> Slightly more complex indexing logic.
                                    </TextBlock>
                                </Border>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Strategy 3: Memory-Mapped Files">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap">
                                    For very large data, use memory-mapped files instead of in-memory arrays:
                                </TextBlock>

                                <WrapPanel Margin="0,10,0,0">
                                    <Button Content="Create Memory-Mapped File (100 MB)" Click="CreateMemoryMapped_Click"/>
                                    <Button Content="Access Data" Click="AccessMemoryMapped_Click"/>
                                    <Button Content="Dispose MMF" Click="DisposeMemoryMapped_Click"/>
                                </WrapPanel>

                                <TextBlock x:Name="MMFResult" Text="" Margin="0,10,0,0" TextWrapping="Wrap"/>

                                <Border Background="#E8F5E9" Padding="10" Margin="0,10,0,0" BorderBrush="#4CAF50" BorderThickness="1">
                                    <TextBlock TextWrapping="Wrap">
                                        <Run FontWeight="Bold">Benefit:</Run> OS manages memory, doesn't count against managed heap.
                                        <LineBreak/>
                                        <Run FontWeight="Bold">Use for:</Run> Large datasets, shared memory, caching.
                                    </TextBlock>
                                </Border>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Strategy 4: Struct of Arrays">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap">
                                    Organize data to avoid large object allocations:
                                </TextBlock>

                                <WrapPanel Margin="0,10,0,0">
                                    <Button Content="Array of Structs (bad)" Click="ArrayOfStructs_Click"/>
                                    <Button Content="Struct of Arrays (good)" Click="StructOfArrays_Click"/>
                                </WrapPanel>

                                <TextBlock x:Name="SOAResult" Text="" Margin="0,10,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Real-World Examples -->
            <TabItem Header="Real-World Examples">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="Real-World LOH Scenarios" FontSize="18" FontWeight="Bold"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,5">
                            Common scenarios where LOH management is critical.
                        </TextBlock>

                        <GroupBox Header="Example 1: Image Processing">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap">
                                    Processing large images (e.g., 4K, 8K) involves large buffers:
                                </TextBlock>

                                <WrapPanel Margin="0,10,0,0">
                                    <Button Content="Process Without Pool" Click="ProcessImageWithoutPool_Click"/>
                                    <Button Content="Process With Pool" Click="ProcessImageWithPool_Click"/>
                                </WrapPanel>

                                <TextBlock x:Name="ImageProcessingResult" Text="" Margin="0,10,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Example 2: Network Buffers">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap">
                                    Network operations often need large receive/send buffers:
                                </TextBlock>

                                <WrapPanel Margin="0,10,0,0">
                                    <Button Content="Simulate 100 Connections" Click="SimulateNetworkBuffers_Click"/>
                                </WrapPanel>

                                <TextBlock x:Name="NetworkBufferResult" Text="" Margin="0,10,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Example 3: Caching Large Data">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap">
                                    Caching deserialized data can create LOH pressure:
                                </TextBlock>

                                <WrapPanel Margin="0,10,0,0">
                                    <Button Content="Cache 50 Large Objects" Click="CacheLargeObjects_Click"/>
                                    <Button Content="Clear Cache" Click="ClearCache_Click"/>
                                </WrapPanel>

                                <TextBlock x:Name="CacheResult" Text="" Margin="0,10,0,0" TextWrapping="Wrap"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Live Statistics Panel -->
        <Border Grid.Row="2" Background="#4A148C" Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Live LOH Statistics" FontSize="16" FontWeight="Bold" Foreground="White" Margin="0,0,0,10"/>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Total Memory -->
                    <Border Grid.Column="0" Background="#6A1B9A" Padding="10" Margin="5" CornerRadius="5">
                        <StackPanel>
                            <TextBlock Text="Total Memory" FontWeight="Bold" Foreground="#CE93D8" FontSize="12"/>
                            <TextBlock x:Name="LiveTotalMemory" Text="0 MB" Foreground="White" FontSize="18" Margin="0,5,0,0"/>
                            <TextBlock x:Name="LiveSOHMemory" Text="SOH: 0 MB" Foreground="#BA68C8" Margin="0,5,0,0"/>
                            <TextBlock x:Name="LiveLOHMemory" Text="LOH: 0 MB" Foreground="#AB47BC" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- LOH Stats -->
                    <Border Grid.Column="1" Background="#6A1B9A" Padding="10" Margin="5" CornerRadius="5">
                        <StackPanel>
                            <TextBlock Text="LOH Details" FontWeight="Bold" Foreground="#CE93D8" FontSize="12"/>
                            <TextBlock x:Name="LiveLOHSize" Text="Size: 0 MB" Foreground="White" FontSize="14" Margin="0,5,0,0"/>
                            <TextBlock x:Name="LiveLOHFragmented" Text="Fragmented: 0 MB" Foreground="#FF8A80" Margin="0,5,0,0"/>
                            <TextBlock x:Name="LiveFragmentationPercent" Text="Fragmentation: 0%" Foreground="#FFAB91" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Collection Stats -->
                    <Border Grid.Column="2" Background="#6A1B9A" Padding="10" Margin="5" CornerRadius="5">
                        <StackPanel>
                            <TextBlock Text="Collections" FontWeight="Bold" Foreground="#CE93D8" FontSize="12"/>
                            <TextBlock x:Name="LiveGen2Count" Text="Gen2: 0" Foreground="White" FontSize="14" Margin="0,5,0,0"/>
                            <TextBlock x:Name="LiveCompactionMode" Text="Compaction: Default" Foreground="#90CAF9" Margin="0,5,0,0"/>
                            <TextBlock x:Name="LiveLastPause" Text="Last pause: 0 ms" Foreground="#FFA726" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Controls -->
                    <StackPanel Grid.Column="3" VerticalAlignment="Center" Margin="10,0">
                        <Button Content="Refresh Stats" Click="RefreshLiveStats_Click" Background="#7B1FA2" Foreground="White"/>
                        <Button Content="Force GC" Click="ForceGC_Click" Background="#AD1457" Foreground="White" Margin="0,5,0,0"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
