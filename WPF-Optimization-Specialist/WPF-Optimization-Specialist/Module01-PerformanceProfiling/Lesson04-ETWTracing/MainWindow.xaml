<Window x:Class="Lesson04_ETWTracing.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="WPF ETW Tracing - Module 01 Lesson 04"
        Height="900" Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="#F0F0F0">

    <Window.Resources>
        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#0078D4"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <Style x:Key="SubHeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="Margin" Value="0,5,0,5"/>
        </Style>

        <Style x:Key="EventItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="0,1"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="White" Padding="15" CornerRadius="5" Margin="0,0,0,10">
            <StackPanel>
                <TextBlock Text="Event Tracing for Windows (ETW) Monitor"
                          FontSize="24" FontWeight="Bold"
                          Foreground="#0078D4" Margin="0,0,0,5"/>
                <TextBlock Text="Learn how to implement and monitor ETW providers for detailed application tracing"
                          FontSize="14" Foreground="#666666"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Event Generation -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="0,0,5,0">
                <StackPanel>
                    <!-- Event Source Info -->
                    <GroupBox Header="ETW Event Source Information">
                        <StackPanel>
                            <Border Background="#E3F2FD" Padding="10" CornerRadius="3" Margin="0,0,0,10">
                                <StackPanel>
                                    <TextBlock Text="Event Source Details" FontWeight="Bold" Margin="0,0,0,5"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:" FontWeight="SemiBold" Margin="0,2"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="EventSourceNameText"
                                                  Text="WPF-Learning-App" Margin="5,2"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="GUID:" FontWeight="SemiBold" Margin="0,2"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" x:Name="EventSourceGuidText"
                                                  Text="Loading..." Margin="5,2" FontFamily="Consolas" FontSize="10"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Status:" FontWeight="SemiBold" Margin="0,2"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" x:Name="EventSourceStatusText"
                                                  Text="Active" Foreground="Green" Margin="5,2"/>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <TextBlock Text="ETW allows detailed application instrumentation with minimal overhead. Events can be collected in production without recompilation."
                                      TextWrapping="Wrap" FontSize="11" Foreground="#666666" Margin="0,0,0,10"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Event Generation -->
                    <GroupBox Header="Generate ETW Events">
                        <StackPanel>
                            <!-- Informational Events -->
                            <Border Background="White" Padding="10" Margin="0,5" CornerRadius="3">
                                <StackPanel>
                                    <TextBlock Text="Informational Events" Style="{StaticResource SubHeaderTextBlock}"/>

                                    <Button Content="Log User Action" Click="LogUserAction_Click" Margin="0,5"/>
                                    <Button Content="Log Data Loaded" Click="LogDataLoaded_Click" Margin="0,5"/>
                                    <Button Content="Log Configuration Change" Click="LogConfigChange_Click" Margin="0,5"/>
                                </StackPanel>
                            </Border>

                            <!-- Warning Events -->
                            <Border Background="White" Padding="10" Margin="0,5" CornerRadius="3">
                                <StackPanel>
                                    <TextBlock Text="Warning Events" Style="{StaticResource SubHeaderTextBlock}"/>

                                    <Button Content="Log Slow Operation" Click="LogSlowOperation_Click"
                                           Background="#FFA500" Margin="0,5"/>
                                    <Button Content="Log Resource Warning" Click="LogResourceWarning_Click"
                                           Background="#FFA500" Margin="0,5"/>
                                    <Button Content="Log Retry Attempt" Click="LogRetryAttempt_Click"
                                           Background="#FFA500" Margin="0,5"/>
                                </StackPanel>
                            </Border>

                            <!-- Error Events -->
                            <Border Background="White" Padding="10" Margin="0,5" CornerRadius="3">
                                <StackPanel>
                                    <TextBlock Text="Error Events" Style="{StaticResource SubHeaderTextBlock}"/>

                                    <Button Content="Log Operation Failed" Click="LogOperationFailed_Click"
                                           Background="#D32F2F" Margin="0,5"/>
                                    <Button Content="Log Exception" Click="LogException_Click"
                                           Background="#D32F2F" Margin="0,5"/>
                                    <Button Content="Log Critical Error" Click="LogCriticalError_Click"
                                           Background="#8B0000" Margin="0,5"/>
                                </StackPanel>
                            </Border>

                            <!-- Performance Events -->
                            <Border Background="White" Padding="10" Margin="0,5" CornerRadius="3">
                                <StackPanel>
                                    <TextBlock Text="Performance Events" Style="{StaticResource SubHeaderTextBlock}"/>

                                    <Button Content="Start/Stop Operation" Click="StartStopOperation_Click"
                                           Background="#10893E" Margin="0,5"/>
                                    <Button Content="Log with Duration" Click="LogWithDuration_Click"
                                           Background="#10893E" Margin="0,5"/>
                                    <Button Content="Simulate Complex Operation" Click="SimulateComplexOp_Click"
                                           Background="#10893E" Margin="0,5"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </GroupBox>

                    <!-- Statistics -->
                    <GroupBox Header="Event Statistics">
                        <Border Background="White" Padding="10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Total Events:"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TotalEventsText" Text="0" FontWeight="Bold"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Info Events:"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" x:Name="InfoEventsText" Text="0" Foreground="Blue"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Warning Events:"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" x:Name="WarningEventsText" Text="0" Foreground="Orange"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Error Events:"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" x:Name="ErrorEventsText" Text="0" Foreground="Red"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Critical Events:"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" x:Name="CriticalEventsText" Text="0" Foreground="DarkRed"/>

                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Verbose Events:"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" x:Name="VerboseEventsText" Text="0" Foreground="Gray"/>
                            </Grid>
                        </Border>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>

            <!-- Right Panel - Event Log Display -->
            <Grid Grid.Column="1" Margin="5,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Filter Controls -->
                <GroupBox Grid.Row="0" Header="Event Filters">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="Show:" VerticalAlignment="Center" Margin="5,0"/>
                            <CheckBox x:Name="ShowInfoCheckBox" Content="Info" IsChecked="True" Margin="5,0" Checked="FilterChanged" Unchecked="FilterChanged"/>
                            <CheckBox x:Name="ShowWarningCheckBox" Content="Warning" IsChecked="True" Margin="5,0" Checked="FilterChanged" Unchecked="FilterChanged"/>
                            <CheckBox x:Name="ShowErrorCheckBox" Content="Error" IsChecked="True" Margin="5,0" Checked="FilterChanged" Unchecked="FilterChanged"/>
                            <CheckBox x:Name="ShowCriticalCheckBox" Content="Critical" IsChecked="True" Margin="5,0" Checked="FilterChanged" Unchecked="FilterChanged"/>
                            <CheckBox x:Name="ShowVerboseCheckBox" Content="Verbose" IsChecked="True" Margin="5,0" Checked="FilterChanged" Unchecked="FilterChanged"/>
                        </StackPanel>

                        <Button Grid.Column="1" Content="Clear Log" Click="ClearLog_Click"
                               Background="#D32F2F" Width="100"/>
                    </Grid>
                </GroupBox>

                <!-- Event Log -->
                <GroupBox Grid.Row="1" Header="Event Trace Log">
                    <ListBox x:Name="EventLogListBox"
                            ItemContainerStyle="{StaticResource EventItemStyle}"
                            FontFamily="Consolas"
                            FontSize="11"
                            ScrollViewer.HorizontalScrollBarVisibility="Auto"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"/>
                </GroupBox>

                <!-- Collection Info -->
                <GroupBox Grid.Row="2" Header="ETW Collection Commands">
                    <StackPanel>
                        <TextBlock Text="Use these commands to collect ETW traces:"
                                  FontWeight="SemiBold" Margin="0,0,0,5"/>

                        <Border Background="#F5F5F5" Padding="8" Margin="0,3" CornerRadius="3">
                            <StackPanel>
                                <TextBlock Text="PerfView (Recommended):" FontWeight="SemiBold" FontSize="10"/>
                                <TextBlock Text="PerfView.exe collect -OnlyProviders=*WPF-Learning-App"
                                          FontFamily="Consolas" FontSize="10" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#F5F5F5" Padding="8" Margin="0,3" CornerRadius="3">
                            <StackPanel>
                                <TextBlock Text="Windows Performance Recorder (WPR):" FontWeight="SemiBold" FontSize="10"/>
                                <TextBlock Text="wpr -start GeneralProfile -recordTempTo C:\temp"
                                          FontFamily="Consolas" FontSize="10" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#F5F5F5" Padding="8" Margin="0,3" CornerRadius="3">
                            <StackPanel>
                                <TextBlock Text="Logman (Command Line):" FontWeight="SemiBold" FontSize="10"/>
                                <TextBlock x:Name="LogmanCommandText"
                                          Text="logman start mysession -p {GUID} -o trace.etl -ets"
                                          FontFamily="Consolas" FontSize="10" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#FFF4CE" BorderBrush="#FFC107" BorderThickness="1" Padding="8" Margin="0,5,0,0">
                            <TextBlock TextWrapping="Wrap" FontSize="10">
                                <Run Text="ðŸ’¡ Tip: " FontWeight="Bold"/>
                                <Run Text="ETW traces can be collected in production with minimal overhead. Use PerfView or WPA to analyze collected traces."/>
                            </TextBlock>
                        </Border>
                    </StackPanel>
                </GroupBox>
            </Grid>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="2" Background="White" Padding="10" Margin="0,10,0,0" CornerRadius="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ETW Provider Active" VerticalAlignment="Center"
                              Foreground="Green" FontWeight="SemiBold" Margin="0,0,10,0"/>
                    <Ellipse Width="12" Height="12" Fill="LimeGreen" VerticalAlignment="Center"/>
                </StackPanel>

                <TextBlock Grid.Column="1"
                          x:Name="StatusText"
                          Text="Ready to generate ETW events"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"
                          FontStyle="Italic"
                          Foreground="#666666"/>

                <Button Grid.Column="2"
                       Content="View in PerfView"
                       Click="ViewInPerfView_Click"
                       Background="#10893E"
                       Width="150"/>
            </Grid>
        </Border>
    </Grid>
</Window>
