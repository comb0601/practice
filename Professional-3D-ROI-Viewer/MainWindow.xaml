<Window x:Class="Professional3DROIViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Professional 3D ROI Viewer" Height="900" Width="1400"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top" Background="{StaticResource PanelBrush}" Foreground="{StaticResource TextBrush}">
            <MenuItem Header="File" Foreground="White">
                <MenuItem Header="New Scene" Click="NewScene_Click" InputGestureText="Ctrl+N"/>
                <MenuItem Header="Open Scene..." Click="OpenScene_Click" InputGestureText="Ctrl+O"/>
                <MenuItem Header="Save Scene" Click="SaveScene_Click" InputGestureText="Ctrl+S"/>
                <MenuItem Header="Save Scene As..." Click="SaveSceneAs_Click" InputGestureText="Ctrl+Shift+S"/>
                <Separator/>
                <MenuItem Header="Export ROI..." Click="ExportROI_Click"/>
                <MenuItem Header="Import Model..." Click="ImportModel_Click"/>
                <Separator/>
                <MenuItem Header="Exit" Click="Exit_Click" InputGestureText="Alt+F4"/>
            </MenuItem>

            <MenuItem Header="Edit" Foreground="White">
                <MenuItem Header="Undo" Click="Undo_Click" InputGestureText="Ctrl+Z" IsEnabled="False"/>
                <MenuItem Header="Redo" Click="Redo_Click" InputGestureText="Ctrl+Y" IsEnabled="False"/>
                <Separator/>
                <MenuItem Header="Delete ROI" Click="DeleteROI_Click" InputGestureText="Del"/>
                <MenuItem Header="Duplicate ROI" Click="DuplicateROI_Click" InputGestureText="Ctrl+D"/>
                <Separator/>
                <MenuItem Header="Select All" Click="SelectAll_Click" InputGestureText="Ctrl+A"/>
            </MenuItem>

            <MenuItem Header="View" Foreground="White">
                <MenuItem Header="Frame Selected" Click="FrameSelected_Click" InputGestureText="F"/>
                <MenuItem Header="Frame All" Click="FrameAll_Click" InputGestureText="A"/>
                <Separator/>
                <MenuItem Header="Perspective Camera" x:Name="menuPerspective" IsCheckable="True" IsChecked="True" Click="CameraMode_Click"/>
                <MenuItem Header="Orthographic Camera" x:Name="menuOrthographic" IsCheckable="True" Click="CameraMode_Click"/>
                <Separator/>
                <MenuItem Header="Toggle Grid" Click="ToggleGrid_Click" InputGestureText="G" IsChecked="True" IsCheckable="True"/>
                <MenuItem Header="Toggle Wireframe" Click="ToggleWireframe_Click" InputGestureText="W" IsCheckable="True"/>
            </MenuItem>

            <MenuItem Header="ROI" Foreground="White">
                <MenuItem Header="Create Box" Click="CreateBox_Click"/>
                <MenuItem Header="Create Sphere" Click="CreateSphere_Click"/>
                <MenuItem Header="Create Cylinder" Click="CreateCylinder_Click"/>
                <MenuItem Header="Create Cone" Click="CreateCone_Click"/>
                <MenuItem Header="Create Ellipsoid" Click="CreateEllipsoid_Click"/>
                <MenuItem Header="Create Torus" Click="CreateTorus_Click"/>
                <Separator/>
                <MenuItem Header="Show All" Click="ShowAll_Click"/>
                <MenuItem Header="Hide All" Click="HideAll_Click"/>
            </MenuItem>

            <MenuItem Header="Tools" Foreground="White">
                <MenuItem Header="Measure Distance" Click="MeasureDistance_Click" InputGestureText="M"/>
                <MenuItem Header="Clipping Planes..." Click="ClippingPlanes_Click" InputGestureText="C"/>
                <MenuItem Header="Statistics" Click="ShowStatistics_Click"/>
            </MenuItem>

            <MenuItem Header="Help" Foreground="White">
                <MenuItem Header="User Guide" Click="UserGuide_Click"/>
                <MenuItem Header="Keyboard Shortcuts" Click="Shortcuts_Click"/>
                <MenuItem Header="About..." Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <ToolBarTray DockPanel.Dock="Top" Background="{StaticResource PanelBrush}">
            <ToolBar Background="{StaticResource PanelBrush}">
                <Button Content="ðŸ“„ New" Style="{StaticResource ToolbarButtonStyle}" Click="NewScene_Click" ToolTip="New Scene (Ctrl+N)"/>
                <Button Content="ðŸ“ Open" Style="{StaticResource ToolbarButtonStyle}" Click="OpenScene_Click" ToolTip="Open Scene (Ctrl+O)"/>
                <Button Content="ðŸ’¾ Save" Style="{StaticResource ToolbarButtonStyle}" Click="SaveScene_Click" ToolTip="Save Scene (Ctrl+S)"/>
                <Separator/>
                <Button Content="âž• Add ROI" Style="{StaticResource ToolbarButtonStyle}" Click="AddROI_Click" ToolTip="Add new ROI"/>
                <Button Content="âž– Remove" Style="{StaticResource ToolbarButtonStyle}" Click="DeleteROI_Click" ToolTip="Remove selected ROI (Del)"/>
                <Button Content="âŽ˜ Duplicate" Style="{StaticResource ToolbarButtonStyle}" Click="DuplicateROI_Click" ToolTip="Duplicate ROI (Ctrl+D)"/>
                <Separator/>
                <Button Content="ðŸ” Frame" Style="{StaticResource ToolbarButtonStyle}" Click="FrameSelected_Click" ToolTip="Frame selected (F)"/>
                <Button Content="ðŸ“ Measure" Style="{StaticResource ToolbarButtonStyle}" Click="MeasureDistance_Click" ToolTip="Measure distance (M)"/>
            </ToolBar>
        </ToolBarTray>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom" Background="#007ACC" Foreground="White" Height="25">
            <StatusBarItem>
                <TextBlock x:Name="statusText" Text="Ready"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="roiCountText" Text="ROIs: 0"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="cameraInfoText" Text="Camera: Perspective"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="performanceText" Text="FPS: --"/>
            </StatusBarItem>
        </StatusBar>

        <!-- Main Content -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - ROI List -->
            <Border Grid.Column="0" Background="{StaticResource PanelBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="ROI MANAGER"
                             Background="#007ACC"
                             Foreground="White"
                             FontWeight="Bold"
                             Padding="10,8"
                             FontSize="13"/>

                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                        <Button Content="+" Click="AddROI_Click" Width="35" Height="35" Margin="2" FontSize="20" FontWeight="Bold" Background="#0E639C" Foreground="White" BorderThickness="0" ToolTip="Add ROI"/>
                        <Button Content="âˆ’" Click="DeleteROI_Click" Width="35" Height="35" Margin="2" FontSize="20" FontWeight="Bold" Background="#A12026" Foreground="White" BorderThickness="0" ToolTip="Remove ROI"/>
                        <Button Content="âŽ˜" Click="DuplicateROI_Click" Width="35" Height="35" Margin="2" FontSize="16" FontWeight="Bold" Background="#4A5F7A" Foreground="White" BorderThickness="0" ToolTip="Duplicate ROI"/>
                    </StackPanel>

                    <ListBox x:Name="roiListBox"
                           SelectionChanged="ROIList_SelectionChanged"
                           Background="#1E1E1E"
                           Foreground="White"
                           BorderThickness="0"
                           Margin="5">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox IsChecked="{Binding Visible}"
                                            Checked="Visibility_Changed"
                                            Unchecked="Visibility_Changed"
                                            Margin="0,0,5,0"
                                            ToolTip="Toggle visibility"/>
                                    <Ellipse Width="14" Height="14" Margin="0,0,5,0">
                                        <Ellipse.Fill>
                                            <SolidColorBrush Color="{Binding Color}"/>
                                        </Ellipse.Fill>
                                    </Ellipse>
                                    <TextBlock Text="{Binding Name}" Foreground="White" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Shape, StringFormat='({0})'}" Foreground="#888" Margin="5,0,0,0" VerticalAlignment="Center" FontSize="10"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <!-- Center - 3D Viewport -->
            <Border Grid.Column="1" Background="Black" Margin="0">
                <Grid>
                    <Viewport3D x:Name="viewport"
                              MouseLeftButtonDown="Viewport_MouseLeftButtonDown"
                              MouseMove="Viewport_MouseMove"
                              MouseLeftButtonUp="Viewport_MouseLeftButtonUp"
                              MouseWheel="Viewport_MouseWheel"
                              MouseRightButtonDown="Viewport_MouseRightButtonDown"
                              MouseRightButtonUp="Viewport_MouseRightButtonUp">

                        <Viewport3D.Camera>
                            <PerspectiveCamera x:Name="camera"
                                             Position="15,12,20"
                                             LookDirection="-15,-12,-20"
                                             UpDirection="0,1,0"
                                             FieldOfView="60"/>
                        </Viewport3D.Camera>

                        <!-- Lights -->
                        <ModelVisual3D>
                            <ModelVisual3D.Content>
                                <Model3DGroup>
                                    <AmbientLight Color="#808080"/>
                                    <DirectionalLight Color="#FFFFFF" Direction="-1,-1,-3"/>
                                    <DirectionalLight Color="#909090" Direction="1,1,3"/>
                                    <DirectionalLight Color="#606060" Direction="0,-1,0"/>
                                </Model3DGroup>
                            </ModelVisual3D.Content>
                        </ModelVisual3D>

                        <!-- Grid -->
                        <ModelVisual3D x:Name="gridModel"/>

                        <!-- Axes -->
                        <ModelVisual3D x:Name="axesModel"/>

                        <!-- Clipping Plane Visualization -->
                        <ModelVisual3D x:Name="clippingPlaneModel"/>

                        <!-- ROI Container -->
                        <ModelVisual3D x:Name="roiContainer"/>

                    </Viewport3D>

                    <!-- Overlay Info -->
                    <StackPanel VerticalAlignment="Top" HorizontalAlignment="Left" Margin="15">
                        <Border Background="#CC000000" Padding="10" CornerRadius="4">
                            <StackPanel>
                                <TextBlock Text="PROFESSIONAL 3D ROI VIEWER" Foreground="White" FontWeight="Bold" FontSize="14"/>
                                <TextBlock Text="Interactive ROI Manipulation &amp; Visualization" Foreground="#4EC9B0" FontSize="11" Margin="0,2,0,0"/>
                                <TextBlock x:Name="helpText" Text="Left Drag: Rotate | Right Drag: Pan | Scroll: Zoom" Foreground="#CCC" FontSize="10" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Axis Indicator -->
                    <Border VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="15" Background="#CC000000" Padding="8" CornerRadius="3">
                        <StackPanel>
                            <TextBlock Text="AXES" Foreground="White" FontWeight="Bold" FontSize="10" Margin="0,0,0,3"/>
                            <TextBlock Text="â— X" Foreground="#FF6B6B" FontSize="10"/>
                            <TextBlock Text="â— Y" Foreground="#4ECDC4" FontSize="10"/>
                            <TextBlock Text="â— Z" Foreground="#45B7D1" FontSize="10"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Right Panel - Properties -->
            <Border Grid.Column="2" Background="{StaticResource PanelBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="propertiesPanel" Margin="15">
                        <TextBlock Text="ROI PROPERTIES"
                                 Foreground="White"
                                 FontSize="14"
                                 FontWeight="Bold"
                                 Margin="0,0,0,15"/>

                        <!-- ROI Name -->
                        <TextBlock Text="Name" Style="{StaticResource SectionHeaderStyle}"/>
                        <TextBox x:Name="txtName" TextChanged="Property_Changed" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="5"/>

                        <!-- Shape Selection -->
                        <TextBlock Text="SHAPE" Style="{StaticResource SectionHeaderStyle}"/>
                        <ComboBox x:Name="shapeCombo" SelectionChanged="Shape_Changed" Background="#1E1E1E" Foreground="White" Padding="5">
                            <ComboBoxItem Content="Box"/>
                            <ComboBoxItem Content="Sphere"/>
                            <ComboBoxItem Content="Cylinder"/>
                            <ComboBoxItem Content="Cone"/>
                            <ComboBoxItem Content="Ellipsoid"/>
                            <ComboBoxItem Content="Torus"/>
                        </ComboBox>

                        <!-- Position -->
                        <TextBlock Text="POSITION" Style="{StaticResource SectionHeaderStyle}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="X" Foreground="#FF6B6B" FontWeight="Bold" VerticalAlignment="Center"/>
                            <Slider Grid.Row="0" Grid.Column="1" x:Name="sliderX" Minimum="-20" Maximum="20" Value="0" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="0" Grid.Column="2" x:Name="txtX" Text="0.00" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Y" Foreground="#4ECDC4" FontWeight="Bold" VerticalAlignment="Center"/>
                            <Slider Grid.Row="1" Grid.Column="1" x:Name="sliderY" Minimum="-20" Maximum="20" Value="0" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="1" Grid.Column="2" x:Name="txtY" Text="0.00" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Z" Foreground="#45B7D1" FontWeight="Bold" VerticalAlignment="Center"/>
                            <Slider Grid.Row="2" Grid.Column="1" x:Name="sliderZ" Minimum="-20" Maximum="20" Value="0" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="2" Grid.Column="2" x:Name="txtZ" Text="0.00" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>
                        </Grid>

                        <!-- Size -->
                        <TextBlock Text="SIZE" Style="{StaticResource SectionHeaderStyle}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Width" Foreground="#CCC" VerticalAlignment="Center"/>
                            <Slider Grid.Row="0" Grid.Column="1" x:Name="sliderWidth" Minimum="0.1" Maximum="10" Value="2" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="0" Grid.Column="2" x:Name="txtWidth" Text="2.00" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Height" Foreground="#CCC" VerticalAlignment="Center"/>
                            <Slider Grid.Row="1" Grid.Column="1" x:Name="sliderHeight" Minimum="0.1" Maximum="10" Value="2" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="1" Grid.Column="2" x:Name="txtHeight" Text="2.00" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Depth" Foreground="#CCC" VerticalAlignment="Center"/>
                            <Slider Grid.Row="2" Grid.Column="1" x:Name="sliderDepth" Minimum="0.1" Maximum="10" Value="2" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="2" Grid.Column="2" x:Name="txtDepth" Text="2.00" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>
                        </Grid>

                        <!-- Rotation -->
                        <TextBlock Text="ROTATION" Style="{StaticResource SectionHeaderStyle}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="X" Foreground="#FF6B6B" FontWeight="Bold" VerticalAlignment="Center"/>
                            <Slider Grid.Row="0" Grid.Column="1" x:Name="sliderRotX" Minimum="0" Maximum="360" Value="0" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="0" Grid.Column="2" x:Name="txtRotX" Text="0Â°" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Y" Foreground="#4ECDC4" FontWeight="Bold" VerticalAlignment="Center"/>
                            <Slider Grid.Row="1" Grid.Column="1" x:Name="sliderRotY" Minimum="0" Maximum="360" Value="0" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="1" Grid.Column="2" x:Name="txtRotY" Text="0Â°" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Z" Foreground="#45B7D1" FontWeight="Bold" VerticalAlignment="Center"/>
                            <Slider Grid.Row="2" Grid.Column="1" x:Name="sliderRotZ" Minimum="0" Maximum="360" Value="0" ValueChanged="Property_Changed" Margin="5,3"/>
                            <TextBox Grid.Row="2" Grid.Column="2" x:Name="txtRotZ" Text="0Â°" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>
                        </Grid>

                        <!-- Appearance -->
                        <TextBlock Text="APPEARANCE" Style="{StaticResource SectionHeaderStyle}"/>

                        <TextBlock Text="Color" Foreground="#CCC" FontSize="10" Margin="0,5,0,2"/>
                        <ComboBox x:Name="colorCombo" SelectionChanged="Color_Changed" Background="#1E1E1E" Foreground="White">
                            <ComboBoxItem Content="Red" Tag="#FF0000"/>
                            <ComboBoxItem Content="Green" Tag="#00FF00"/>
                            <ComboBoxItem Content="Blue" Tag="#0000FF"/>
                            <ComboBoxItem Content="Yellow" Tag="#FFFF00"/>
                            <ComboBoxItem Content="Cyan" Tag="#00FFFF"/>
                            <ComboBoxItem Content="Magenta" Tag="#FF00FF"/>
                            <ComboBoxItem Content="Orange" Tag="#FFA500"/>
                            <ComboBoxItem Content="Purple" Tag="#800080"/>
                        </ComboBox>

                        <TextBlock Text="Opacity" Foreground="#CCC" FontSize="10" Margin="0,8,0,2"/>
                        <DockPanel>
                            <TextBox DockPanel.Dock="Right" x:Name="txtOpacity" Text="70%" Width="45" Background="#1E1E1E" Foreground="White" BorderBrush="#555" Padding="3" FontSize="10"/>
                            <Slider x:Name="sliderOpacity" Minimum="10" Maximum="100" Value="70" ValueChanged="Opacity_Changed" Margin="0,0,5,0"/>
                        </DockPanel>

                        <CheckBox x:Name="chkWireframe" Content="Show Wireframe" Foreground="White" IsChecked="True" Checked="Wireframe_Changed" Unchecked="Wireframe_Changed" Margin="0,8,0,0"/>

                        <!-- Information -->
                        <TextBlock Text="INFORMATION" Style="{StaticResource SectionHeaderStyle}"/>
                        <Border Background="#1E1E1E" BorderBrush="#555" BorderThickness="1" Padding="8" CornerRadius="3">
                            <StackPanel>
                                <TextBlock x:Name="txtVolume" Text="Volume: 0.00" Foreground="#CCC" FontSize="10"/>
                                <TextBlock x:Name="txtCenter" Text="Center: (0, 0, 0)" Foreground="#CCC" FontSize="10" Margin="0,3,0,0"/>
                                <TextBlock x:Name="txtBounds" Text="Bounds: N/A" Foreground="#CCC" FontSize="10" Margin="0,3,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Quick Actions -->
                        <TextBlock Text="QUICK ACTIONS" Style="{StaticResource SectionHeaderStyle}"/>
                        <Button Content="Center to Origin" Click="CenterToOrigin_Click" Style="{StaticResource ToolbarButtonStyle}" Margin="0,2"/>
                        <Button Content="Reset Rotation" Click="ResetRotation_Click" Style="{StaticResource ToolbarButtonStyle}" Margin="0,2"/>
                        <Button Content="Reset Scale" Click="ResetScale_Click" Style="{StaticResource ToolbarButtonStyle}" Margin="0,2"/>

                        <TextBlock Text="Professional 3D ROI Viewer v1.0"
                                 Foreground="#666"
                                 FontSize="9"
                                 Margin="0,30,0,0"
                                 HorizontalAlignment="Center"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </DockPanel>
</Window>
